/*
 *  jQuery formulae - v0.0.1
 *  Build formula's with your own values.
 *  #
 *
 *  Made by Roy Wulms
 *  Under MIT License
 */
!function(a){function b(b,e){this.element=b,this.options=a.extend({},d,e),this._defaults=d,this._name=c,this.init()}var c="jqueryFormulae",d={wrapper:'<ul class="jqueryFormulae"></ul>',items:"li",newMsg:"Selecteer actie",removeicon:"glyphicon glyphicon-remove",popoverPlacement:"auto top",inputs:{},defaultinputs:[{name:"custom",type:"number","class":"custom"}],math:[{label:'<span class="glyphicon glyphicon-plus"></span>',value:"+"},{label:'<span class="glyphicon glyphicon-minus"></span>',value:"-"},{label:'<span class="glyphicon glyphicon-remove"></span>',value:"*"}]};b.prototype={init:function(){this.wrapper=a(this.options.wrapper),this.createBuilder()},createBuilder:function(){var b=this.itemsBuilder(this.options.items);this.newlink=a('<a href="#" class="btn btn-default">'+this.options.newMsg+"</a>").popover({html:!0,placement:this.options.popoverPlacement,content:this.addAction()}),a(this.element).html(this.wrapper.html(b.append(this.newlink)))},addAction:function(){var b,c;return b=a("<ul></ul>").addClass("action-overview"),c=a.merge(this.options.defaultinputs,this.options.inputs),a.each(c,a.proxy(function(c,d){var e=a('<a class="addAction"></a>').html(d.name).on("click",a.proxy(function(){a(this.newlink).popover("hide"),this.wrapper.children("li").length>1&&a(this.newlink).parent(this.options.items).before(this.mathBuilder()),a(this.newlink).parent(this.options.items).before(this.inputBuilder(d))},this));b.append(a("<li></li>").html(e))},this)),b},operatorsHtml:function(b,c){var d,e;return d=a("<ul></ul>").addClass("operator-overview"),a.each(this.options.math,a.proxy(function(f,g){var h=a('<a class="addMath" data-operator ="'+f+'"></a>').html(g.label).on("click",a.proxy(function(d){e=a(d.currentTarget).attr("data-operator"),this.saveOperators(a(d.currentTarget),b,e,c)},this));d.append(a("<li></li>").html(h))},this)),d},saveOperators:function(b,c,d,e){b.closest("div.popover").popover("hide"),a(c).html(this.options.math[d].label),a(e).val(this.options.math[d].value)},itemsBuilder:function(b){var c="";switch(b){case"li":c=a('<li class="formulae-item"></li>');break;case"div":c=a('<div class="formulae-item"></div>')}return c},inputBuilder:function(b){var c,d,e,f,g;switch(c=this.itemsBuilder(this.options.items),e="",b.type){case"number":e=a('<input class="form-control" type="number" name="math[value]"></input>');break;case"select":e=a('<select class="form-control" name="math[value]"></select>'),a.each(b.values,function(b,c){var d=a("<option></option>").attr("value",c.value).html(c.label);e.append(d)})}return f=this.removeFormulaItem(),d=a("<div></div>").addClass("input-group").append(e,f),g=c.addClass(b.class).html(d)},mathBuilder:function(){var b,c,d;return b=this.itemsBuilder(this.options.items),c=a("<a></a>").addClass("mathBuilder").html(this.options.math[0].label),d=a('<input type="hidden" name="math[formula]">').val(this.options.math[0].value),c.popover({html:!0,placement:this.options.popoverPlacement,content:this.operatorsHtml(c,d)}),b.addClass("operator").html(c).append(d)},removeFormulaItem:function(){var b,c,d;return d=a('<span class="input-group-addon">'),c=a("<a></a>").addClass("removelink").append('<i class="'+this.options.removeicon+'"></i>').on("click",function(){var b,c;b=a(this).closest("li"),c=b.prev("li.operator"),0===c.length?b.next("li.operator").remove():c.remove(),b.remove()}),b=d.append(c)}},a.fn[c]=function(d){return this.each(function(){a.data(this,"plugin_"+c)||a.data(this,"plugin_"+c,new b(this,d))})}}(jQuery,window,document);